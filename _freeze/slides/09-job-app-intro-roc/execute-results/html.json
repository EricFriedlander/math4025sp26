{
  "hash": "34cfc26ff4d75359217f1931f1438aea",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'MATH 427: ROC Curve and AUC'\nauthor: Eric Friedlander\nfooter: \"[ðŸ”— MAT 427 - Spring 2025 -  Schedule](https://mat427sp25.netlify.app/schedule)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: false\n    incremental: false \n    chalkboard: true\nexecute:\n  freeze: auto\n  echo: true\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\n---\n\n\n\n\n## Announcements {.smaller}\n\nOn March 5th at 10am in JAAC, Kyle Mayer will be guest lecturing to talk about his role as a data analyst at Micron. Kyle has a Bachelors in Engineering and a Masters in Physics. \n\nBio: Kyle Mayer is a Senior Data Analytics Engineer at Micron Technology with over 15 years of experience. He currently supports the Global Quality organization with engineering and data science projects. Kyle specializes in modeling complex physical processes, delivering insights that drive business value. Leveraging his expertise in semiconductor manufacturing, Kyle has developed tools and processes that have prevented over $100M in lost revenue. His passion for applying artificial intelligence to solve complex problems and develop automated systems highlights his commitment to innovation. In his spare time, Kyle enjoys spending time with his kids and going on hikes.\n\n## Job Application 1\n\n- [Job Ad](https://cofi.instructure.com/courses/17021/assignments/210575)\n- [Directions and Resources](/jobs/job-app-1-resources.qmd)\n- [Rubic (in progress)](/jobs/job-app-1-rubric.qmd)\n- Due Next Friday: CV and Cover Letter\n- Due Friday March 21st: whole application\n\n## Computational Set-Up\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(knitr)\nlibrary(janitor) # for contingency tables\nlibrary(ISLR2)\nlibrary(ggforce) # sina plots\n\ntidymodels_prefer()\n\nset.seed(427)\n```\n:::\n\n\n\n\n\n\n## Default Dataset {.smaller}\n\n::: columns\n::: column\nA simulated data set containing information on ten thousand customers. The aim here is to predict which customers will default on their credit card debt.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(Default) |> kable()  # print first six observations\n```\n\n::: {.cell-output-display}\n\n\n|default |student |   balance|    income|\n|:-------|:-------|---------:|---------:|\n|No      |No      |  729.5265| 44361.625|\n|No      |Yes     |  817.1804| 12106.135|\n|No      |No      | 1073.5492| 31767.139|\n|No      |No      |  529.2506| 35704.494|\n|No      |No      |  785.6559| 38463.496|\n|No      |Yes     |  919.5885|  7491.559|\n\n\n:::\n:::\n\n\n\n:::\n\n::: column\n**Response Variable**: `default`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDefault |> \n  tabyl(default) |>  # class frequencies\n  kable()           # Make it look nice\n```\n\n::: {.cell-output-display}\n\n\n|default |    n| percent|\n|:-------|----:|-------:|\n|No      | 9667|  0.9667|\n|Yes     |  333|  0.0333|\n\n\n:::\n:::\n\n\n\n:::\n:::\n\n## Split the data\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(427)\n\ndefault_split <- initial_split(Default, prop = 0.6, strata = default)\ndefault_split\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<Training/Testing/Total>\n<6000/4000/10000>\n```\n\n\n:::\n\n```{.r .cell-code}\ndefault_train <- training(default_split)\ndefault_test <- testing(default_split)\n```\n:::\n\n\n\n\n## [K-Nearest Neighbors Classifier: Build Model]{.r-fit-text}\n\n-   **Response** ($Y$): `default`\n-   **Predictor** ($X$): `balance`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknnfit <- nearest_neighbor(neighbors = 10) |> \n  set_engine(\"kknn\") |> \n  set_mode(\"classification\") |>  \n  fit(default ~ balance, data = default_train)   # fit 10-nn model\n```\n:::\n\n\n\n\n## [K-Nearest Neighbors Classifier: Predictions]{.r-fit-text} {.smaller}\n\n::: panel-tabset\n## Class labels\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredict(knnfit, new_data = default_test, type = \"class\") |> head() |> kable()   # obtain predictions as classes\n```\n\n::: {.cell-output-display}\n\n\n|.pred_class |\n|:-----------|\n|No          |\n|No          |\n|No          |\n|No          |\n|No          |\n|No          |\n\n\n:::\n:::\n\n\n\n\n## Probabilities\n\n-   Predicts class w/ maximum probability\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredict(knnfit, new_data = default_test, type = \"prob\") |> head() |> kable() # obtain predictions as probabilities\n```\n\n::: {.cell-output-display}\n\n\n| .pred_No| .pred_Yes|\n|--------:|---------:|\n|        1|         0|\n|        1|         0|\n|        1|         0|\n|        1|         0|\n|        1|         0|\n|        1|         0|\n\n\n:::\n:::\n\n\n\n:::\n\n## Fitting a logistic regression\n\nFitting a logistic regression model with `default` as the response and `balance` as the predictor:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlogregfit <- logistic_reg() |> \n  set_engine(\"glm\") |> \n  fit(default ~ balance, data = default_train)   # fit logistic regression model\n\ntidy(logregfit) |> kable()  # obtain results\n```\n\n::: {.cell-output-display}\n\n\n|term        |    estimate| std.error| statistic| p.value|\n|:-----------|-----------:|---------:|---------:|-------:|\n|(Intercept) | -10.6926385| 0.4659035| -22.95033|       0|\n|balance     |   0.0055327| 0.0002841|  19.47329|       0|\n\n\n:::\n:::\n\n\n\n\n## Making predictions in R\n\n::: panel-tabset\n\n## Class Labels\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredict(logregfit, new_data = tibble(balance = 700), type = \"class\") |> kable()   # obtain class predictions\n```\n\n::: {.cell-output-display}\n\n\n|.pred_class |\n|:-----------|\n|No          |\n\n\n:::\n:::\n\n\n\n\n## Log-Odds\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredict(logregfit, new_data = tibble(balance = 700), type = \"raw\") |> kable()   # obtain log-odds predictions\n```\n\n::: {.cell-output-display}\n\n\n|         x|\n|---------:|\n| -6.819727|\n\n\n:::\n:::\n\n\n\n\n## Probabilities\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredict(logregfit, new_data = tibble(balance = 700), type = \"prob\") |> kable()  # obtain probability predictions\n```\n\n::: {.cell-output-display}\n\n\n|  .pred_No| .pred_Yes|\n|---------:|---------:|\n| 0.9989092| 0.0010908|\n\n\n:::\n:::\n\n\n\n\n:::\n\n## Binary Classifiers\n\n-   Start with binary classification scenarios\n-   With binary classification, designate one category as \"Success/Positive\" and the other as \"Failure/Negative\"\n    +   If relevant to your problem: \"Positive\" should be the thing you're trying to predict/care more about\n    +   Note: \"Positive\" $\\neq$ \"Good\"\n    +   For `default`: \"Yes\" is Positive\n-   Some metrics weight \"Positives\" more and viceversa\n\n## Last Time {.smaller}\n\n-   Confusion Matrix\n-   Metrics based on confusion matrix\n    +   Accuracy\n    +   Recall/Sensitivity\n    +   Precision/PPV\n    +   Specificity\n    +   NPV\n    +   MCC\n    +   F-Measure\n-   Today: ROC and AUC\n    \n# Thresholding\n\n\n## Using a threshold {.smaller}\n\n- Step 1: Predict **probabilities** for all observations\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndefault_test_wprobs <- default_test |>\n  mutate(\n    knn_probs = predict(knnfit, new_data = default_test, type = \"prob\") |> pull(.pred_Yes),\n    logistic_probs = predict(logregfit, new_data = default_test, type = \"prob\") |> pull(.pred_Yes)\n  )\n\ndefault_test_wprobs |> head() |> kable()   # obtain probability predictions\n```\n\n::: {.cell-output-display}\n\n\n|default |student |   balance|   income| knn_probs| logistic_probs|\n|:-------|:-------|---------:|--------:|---------:|--------------:|\n|No      |No      |  729.5265| 44361.63|         0|      0.0012842|\n|No      |Yes     |  808.6675| 17600.45|         0|      0.0019883|\n|No      |Yes     | 1220.5838| 13268.56|         0|      0.0190870|\n|No      |No      |  237.0451| 28251.70|         0|      0.0000843|\n|No      |No      |  606.7423| 44994.56|         0|      0.0006514|\n|No      |No      |  286.2326| 45042.41|         0|      0.0001107|\n\n\n:::\n:::\n\n\n\n\n## Using a threshold {.smaller}\n\n- Step 1: Predict **probabilities** for all observations\n- Step 2: Set a threshold to obtain **class labels** (0.5 below)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthreshold <- 0.5   # set threshold\ndefault_test_wprobs <- default_test_wprobs |>\n  mutate(knn_preds = as_factor(if_else(knn_probs > threshold, \"Yes\", \"No\")),\n         logistic_preds = as_factor(if_else(logistic_probs > threshold, \"Yes\", \"No\"))\n  )\n\ndefault_test_wprobs |> head() |> kable()\n```\n\n::: {.cell-output-display}\n\n\n|default |student |   balance|   income| knn_probs| logistic_probs|knn_preds |logistic_preds |\n|:-------|:-------|---------:|--------:|---------:|--------------:|:---------|:--------------|\n|No      |No      |  729.5265| 44361.63|         0|      0.0012842|No        |No             |\n|No      |Yes     |  808.6675| 17600.45|         0|      0.0019883|No        |No             |\n|No      |Yes     | 1220.5838| 13268.56|         0|      0.0190870|No        |No             |\n|No      |No      |  237.0451| 28251.70|         0|      0.0000843|No        |No             |\n|No      |No      |  606.7423| 44994.56|         0|      0.0006514|No        |No             |\n|No      |No      |  286.2326| 45042.41|         0|      0.0001107|No        |No             |\n\n\n:::\n:::\n\n\n\n\n## Using a threshold {.smaller}\n\n- Step 1: Predict **probabilities** for all observations\n- Step 2: Set a threshold to obtain **class labels** (0.5 below)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthreshold <- 0.5   # set threshold\ndefault_test_wprobs <- default_test_wprobs |>\n  mutate(knn_preds = as_factor(if_else(knn_probs > threshold, \"Yes\", \"No\")),\n         logistic_preds = as_factor(if_else(logistic_probs > threshold, \"Yes\", \"No\")))\n\ndefault_test_wprobs |> head() |> kable()\n```\n\n::: {.cell-output-display}\n\n\n|default |student |   balance|   income| knn_probs| logistic_probs|knn_preds |logistic_preds |\n|:-------|:-------|---------:|--------:|---------:|--------------:|:---------|:--------------|\n|No      |No      |  729.5265| 44361.63|         0|      0.0012842|No        |No             |\n|No      |Yes     |  808.6675| 17600.45|         0|      0.0019883|No        |No             |\n|No      |Yes     | 1220.5838| 13268.56|         0|      0.0190870|No        |No             |\n|No      |No      |  237.0451| 28251.70|         0|      0.0000843|No        |No             |\n|No      |No      |  606.7423| 44994.56|         0|      0.0006514|No        |No             |\n|No      |No      |  286.2326| 45042.41|         0|      0.0001107|No        |No             |\n\n\n:::\n:::\n\n\n\n\n## Performance\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroc_metrics <- metric_set(accuracy, sensitivity, specificity)\nroc_metrics(default_test_wprobs, truth = default, estimate = knn_preds, event_level = \"second\") |> kable()\n```\n\n::: {.cell-output-display}\n\n\n|.metric     |.estimator | .estimate|\n|:-----------|:----------|---------:|\n|accuracy    |binary     | 0.9717500|\n|sensitivity |binary     | 0.3565891|\n|specificity |binary     | 0.9922501|\n\n\n:::\n:::\n\n\n\n\n## Low Threshold\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthreshold <- 0.1   # set threshold\ndefault_test_wprobs <- default_test_wprobs |>\n  mutate(knn_preds = as_factor(if_else(knn_probs > threshold, \"Yes\", \"No\")))\n\nroc_metrics(default_test_wprobs, truth = default, estimate = knn_preds, event_level = \"second\")  |> kable()\n```\n\n::: {.cell-output-display}\n\n\n|.metric     |.estimator | .estimate|\n|:-----------|:----------|---------:|\n|accuracy    |binary     | 0.9060000|\n|sensitivity |binary     | 0.7364341|\n|specificity |binary     | 0.9116507|\n\n\n:::\n:::\n\n\n\n\n## High Threshold\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthreshold <- 0.9   # set threshold\ndefault_test_wprobs <- default_test_wprobs |>\n  mutate(knn_preds = as_factor(if_else(knn_probs > threshold, \"Yes\", \"No\"))\n  )\n\nroc_metrics(default_test_wprobs, truth = default, estimate = knn_preds, event_level = \"second\") |> kable()\n```\n\n::: {.cell-output-display}\n\n\n|.metric     |.estimator | .estimate|\n|:-----------|:----------|---------:|\n|accuracy    |binary     | 0.9685000|\n|sensitivity |binary     | 0.0310078|\n|specificity |binary     | 0.9997417|\n\n\n:::\n:::\n\n\n\n\n## Question\n\n-   If I want to improve Recall/Sensitivity should I increase or decrease my threshold?\n-   If I want to improve my Precision/PPV should I increase or decrease my threshold?\n\n# ROC Curve\n\n## ROC Curve and AUC\n\n- **ROC (Receiver Operating Characteristics) curve**: popular graphic for comparing different classifiers across all possible thresholds\n  + Plots the (1-Specificity) along the x-axis and the Sensitivity (true positive rate) along the y-axis\n- **AUC**: area under the AUC curve\n  + Ideal ROC curve will hug the top left corner\n- Idea: How well is my classifier separating positives from negatives\n\n## ROC Curve\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroc_curve(default_test_wprobs, truth = default, knn_probs, event_level = \"second\") |>\n  head() |>\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n| .threshold| specificity| sensitivity|\n|----------:|-----------:|-----------:|\n|       -Inf|   0.0000000|   1.0000000|\n|     0.0000|   0.0000000|   1.0000000|\n|     0.0145|   0.8796177|   0.8217054|\n|     0.0415|   0.8858176|   0.8139535|\n|     0.0560|   0.8971842|   0.7829457|\n|     0.0655|   0.8979592|   0.7751938|\n\n\n:::\n:::\n\n\n\n\n## ROC Curve: Plot\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroc_curve(default_test_wprobs, truth = default, knn_probs, event_level = \"second\") |>\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n\n\n\n\n## AUC\n\n-   AUC: Area under the curve (ROC Curve that is)\n-   Measures how good your model is at separating categories\n-   Only for binary classification\n\n## AUC in R\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroc_auc(default_test_wprobs, truth = default, knn_probs, event_level = \"second\") |>\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|.metric |.estimator | .estimate|\n|:-------|:----------|---------:|\n|roc_auc |binary     | 0.8757397|\n\n\n:::\n:::\n\n\n\n\n\n## Pathological Example 1\n\n:::: columns\n:::: {.column width=\"40%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-21-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n:::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-22-1.png){width=960}\n:::\n:::\n\n\n\n:::\n::::\n\n## Pathological Example 2\n\n:::: columns\n:::: {.column width=\"40%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-23-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n:::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n\n\n:::\n::::\n\n## Pathological Example 3\n\n:::: columns\n:::: {.column width=\"40%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-25-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n:::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-26-1.png){width=960}\n:::\n:::\n\n\n\n:::\n::::\n\n## Pathological Example 4\n\n:::: columns\n:::: {.column width=\"40%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-27-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n:::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-28-1.png){width=960}\n:::\n:::\n\n\n\n:::\n::::\n\n## Pathological Example 5\n\n:::: columns\n:::: {.column width=\"40%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-29-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n:::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-30-1.png){width=960}\n:::\n:::\n\n\n\n:::\n::::\n\n## Pathological Example 6\n\n:::: columns\n:::: {.column width=\"40%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-31-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n:::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-32-1.png){width=960}\n:::\n:::\n\n\n\n::: \n:::: \n\n## Pathological Example 7\n\n:::: columns\n:::: {.column width=\"40%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-33-1.png){width=960}\n:::\n:::\n\n\n\n:::\n\n:::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](09-job-app-intro-roc_files/figure-revealjs/unnamed-chunk-34-1.png){width=960}\n:::\n:::\n\n\n\n:::\n::::\n\n## AUC Questions\n\n-   What should be the minimum AUC?\n-   What should be that maximum possible AUC?\n",
    "supporting": [
      "09-job-app-intro-roc_files\\figure-revealjs"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}